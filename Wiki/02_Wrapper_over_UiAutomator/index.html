
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../kaspresso.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.5.3">
    
    
      
        <title>Wrapper over UiAutomator - Kaspresso</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7a952b86.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="light-blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#kautomator-wrapper-over-ui-automator" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Kaspresso" class="md-header__button md-logo" aria-label="Kaspresso" data-md-component="logo">
      
  <img src="../../kaspresso.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Kaspresso
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Wrapper over UiAutomator
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/KasperskyLab/Kaspresso" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Kaspresso
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../Home/Kaspresso/" class="md-tabs__link">
        Home
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../Tutorial/Android_studio/" class="md-tabs__link">
        Tutorial
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../Page%20object%20in%20Kaspresso/" class="md-tabs__link md-tabs__link--active">
        Wiki
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../Issues/Storage_issue/" class="md-tabs__link">
        Issues
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Kaspresso" class="md-nav__button md-logo" aria-label="Kaspresso" data-md-component="logo">
      
  <img src="../../kaspresso.png" alt="logo">

    </a>
    Kaspresso
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/KasperskyLab/Kaspresso" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Kaspresso
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Home
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Home" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Home/Kaspresso/" class="md-nav__link">
        About Kaspresso
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Home/Kaspresso-in-articles/" class="md-nav__link">
        Kaspresso in articles
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Home/Kaspresso-in-videos/" class="md-nav__link">
        Kasspresso in videos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Home/Kaspresso%20users/" class="md-nav__link">
        Our users
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Home/Breaking-changes/" class="md-nav__link">
        Breaking changes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Tutorial
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorial" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Tutorial
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Tutorial/Android_studio/" class="md-nav__link">
        Скачиваем проект и Android Studio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Tutorial/simple_test/" class="md-nav__link">
        Ваш первый тест на Kaspresso
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Tutorial/off-screen_work/" class="md-nav__link">
        Тестирование за рамками приложения
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Tutorial/Flaky%20safely/" class="md-nav__link">
        Flaky safely. Сontinuously, compose.
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Tutorial/Kaspresso_scenario/" class="md-nav__link">
        Использование сценариев в Kaspresso
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Tutorial/adb_commands/" class="md-nav__link">
        Выполнение adb-команд
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Tutorial/Device/" class="md-nav__link">
        Взаимодействуем с Android вне приложения
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Tutorial/Kaspresso_configurator/" class="md-nav__link">
        Конфигурирование Kaspresso
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Tutorial/Kaspresso_screenshots/" class="md-nav__link">
        Скриншот-тесты
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Tutorial/Kaspresso_with_allure/" class="md-nav__link">
        Использование Allure
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Wiki
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Wiki" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Wiki
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Page%20object%20in%20Kaspresso/" class="md-nav__link">
        Page object in Kaspresso
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../01_Wrapper_over_Espresso/" class="md-nav__link">
        Wrapper over Espresso
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Wrapper over UiAutomator
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Wrapper over UiAutomator
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
    <nav class="md-nav" aria-label="Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#benefits" class="md-nav__link">
    Benefits
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-use-it" class="md-nav__link">
    How to use it
  </a>
  
    <nav class="md-nav" aria-label="How to use it">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-screen" class="md-nav__link">
    Create Screen
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-uiview" class="md-nav__link">
    Create UiView
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write-the-interaction" class="md-nav__link">
    Write the interaction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-difference-from-kakao-espresso" class="md-nav__link">
    The difference from Kakao-Espresso
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced" class="md-nav__link">
    Advanced
  </a>
  
    <nav class="md-nav" aria-label="Advanced">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#custom-uiview" class="md-nav__link">
    Custom UiView
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intercepting" class="md-nav__link">
    Intercepting
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accelerate-ui-automator" class="md-nav__link">
    Accelerate UI Automator
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../03_Kaspresso_configurator/" class="md-nav__link">
        Kaspresso configurator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../04_How_to_write_autotests/" class="md-nav__link">
        How to write autotests
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../05_Device/" class="md-nav__link">
        Device
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../06_AdbServer/" class="md-nav__link">
        AdbServer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../07_DocLoc/" class="md-nav__link">
        DocLoc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../08_Kaspresso-Robolectric/" class="md-nav__link">
        Kaspresso Robolectric
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../09_Kaspresso-Allure/" class="md-nav__link">
        Kaspresso Allure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../10_Jetpack-Compose/" class="md-nav__link">
        Jetpack Compose
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Issues
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Issues" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Issues
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Issues/Storage_issue/" class="md-nav__link">
        Storage issues
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
    <nav class="md-nav" aria-label="Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#benefits" class="md-nav__link">
    Benefits
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-use-it" class="md-nav__link">
    How to use it
  </a>
  
    <nav class="md-nav" aria-label="How to use it">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-screen" class="md-nav__link">
    Create Screen
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-uiview" class="md-nav__link">
    Create UiView
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write-the-interaction" class="md-nav__link">
    Write the interaction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-difference-from-kakao-espresso" class="md-nav__link">
    The difference from Kakao-Espresso
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced" class="md-nav__link">
    Advanced
  </a>
  
    <nav class="md-nav" aria-label="Advanced">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#custom-uiview" class="md-nav__link">
    Custom UiView
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intercepting" class="md-nav__link">
    Intercepting
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accelerate-ui-automator" class="md-nav__link">
    Accelerate UI Automator
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/KasperskyLab/Kaspresso/tree/main/docs/content/Wiki/02_Wrapper_over_UiAutomator.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="kautomator-wrapper-over-ui-automator">Kautomator: wrapper over UI Automator</h1>
<p><strong>Kautomator</strong> - Nice and simple DSL for UI Automator in Kotlin that allows to accelerate UI Automator to amazing. <br>
Inspired by <a href="https://github.com/KakaoCup/Kakao">Kakao</a> and <a href="https://youtu.be/bqNguUHK3SM">russian talk about UI Automator</a> (thanks to Svetlana Smelchakova).</p>
<h3 id="introduction">Introduction</h3>
<p>Tests written with UI Automator are so complex, non-readble and hard to maintain especially for testers.
Have a look at a typical piece of code written with UI Automator:
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="nv">instrumentation</span><span class="p">:</span><span class="w"> </span><span class="n">Instrumentation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InstrumentationRegistry</span><span class="p">.</span><span class="na">getInstrumentation</span><span class="p">()</span><span class="w"></span>
<span class="kd">val</span><span class="w"> </span><span class="nv">uiDevice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UiDevice</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">instrumentation</span><span class="p">)</span><span class="w"></span>

<span class="kd">val</span><span class="w"> </span><span class="nv">uiObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uiDevice</span><span class="p">.</span><span class="na">wait</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">Until</span><span class="p">.</span><span class="na">findObject</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="n">By</span><span class="p">.</span><span class="na">res</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="s">&quot;com.kaspersky.kaspresso.sample_kautomator&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s">&quot;editText&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="m">2</span><span class="n">_000</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>

<span class="n">uiObject</span><span class="p">.</span><span class="na">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Kaspresso&quot;</span><span class="w"></span>
<span class="n">assertEquals</span><span class="p">(</span><span class="n">uiObject</span><span class="p">.</span><span class="na">text</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Kaspresso&quot;</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
This is an example just to input and check the text. Because we have a successful experience of Kakao using we decided to wrap UI Automator over in the same manner and called it <strong>Kautomator</strong>:
<div class="highlight"><pre><span></span><code><span class="n">MainScreen</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">simpleEditText</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">replaceText</span><span class="p">(</span><span class="s">&quot;Kaspresso&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">hasText</span><span class="p">(</span><span class="s">&quot;Kaspresso&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div></p>
<p>Another big advantage of <strong>Kautomator</strong> is a possibility to accelerate UI Automator. <br>
Have a glance at video below: </p>
<p><img alt="" src="https://habrastorage.org/webt/ti/kv/ki/tikvkij1vjesnacrxqm-lk0coly.gif" /> <br>
The left video is boosted UI Automator, the right video is default UI Automator.</p>
<p>Why is it possible? The details are <a href="./#accelerate-ui-automator">available a little bit later</a>.</p>
<h4 id="benefits">Benefits</h4>
<ul>
<li>Readability</li>
<li>Reusability</li>
<li>Extensible DSL</li>
<li>Amazing speed!</li>
</ul>
<h3 id="how-to-use-it">How to use it</h3>
<h4 id="create-screen">Create Screen</h4>
<p>Create your entity <code>UiScreen</code> where you will add the views involved in the interactions of the tests:
<div class="highlight"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nc">FormScreen</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">UiScreen</span><span class="o">&lt;</span><span class="n">FormScreen</span><span class="o">&gt;</span><span class="p">()</span><span class="w"></span>
</code></pre></div>
<code>UiScreen</code> can represent the whole user interface or a portion of UI.
If you are using <a href="https://martinfowler.com/bliki/PageObject.html">Page Object pattern</a> you can put the interactions of Kautomator inside the Page Objects.</p>
<h4 id="create-uiview">Create UiView</h4>
<p><code>UiScreen</code> contains <code>UiView</code>, these are the Android Framework views where you want to do the interactions:
<div class="highlight"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nc">FormScreen</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">UiScreen</span><span class="o">&lt;</span><span class="n">FormScreen</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">phone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UiView</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">withId</span><span class="p">(</span><span class="k">this</span><span class="nd">@FormScreen.packageName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;phone&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UiEditText</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">withId</span><span class="p">(</span><span class="k">this</span><span class="nd">@FormScreen.packageName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;email_edit&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">submit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UiButton</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">withId</span><span class="p">(</span><span class="k">this</span><span class="nd">@FormScreen.packageName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;submit_button&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
Kautomator provides different types depending on the type of view:
* <code>UiView</code>
* <code>UiEditText</code>
* <code>UiTextView</code>
* <code>UiButton</code>
* <code>UiCheckbox</code>
* <code>UiChipGroup</code>
* <code>UiSwitchView</code>
* <code>UiScrollView</code>
* <b>and more</b></p>
<p>Every <code>UiView</code> contains matchers to retrieve the view involved in the <code>ViewInteraction</code>. Some examples of matchers provided
by Kakao:</p>
<ul>
<li><code>withId</code></li>
<li><code>withText</code></li>
<li><code>withPackage</code></li>
<li><code>withContentDescription</code></li>
<li><code>textStartsWith</code></li>
<li><b>and more</b></li>
</ul>
<p>Like in Ui Automator you can combine different matchers:
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="nv">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UiEditText</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">withId</span><span class="p">(</span><span class="k">this</span><span class="nd">@FormScreen.packageName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;email&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">withText</span><span class="p">(</span><span class="k">this</span><span class="nd">@FormScreen.packageName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;matsyuk@kaspresso.com&quot;</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div></p>
<h4 id="write-the-interaction">Write the interaction</h4>
<p>The syntax of the test with Kautomator is very easy, once you have the <code>UiScreen</code> and the <code>UiView</code> defined, you only have to apply
the actions or assertions like in UI Automator:
<div class="highlight"><pre><span></span><code><span class="n">FormScreen</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">phone</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="n">hasText</span><span class="p">(</span><span class="s">&quot;971201771&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">button</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="n">click</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div></p>
<h4 id="the-difference-from-kakao-espresso">The difference from Kakao-Espresso</h4>
<p>In Espresso, all interaction with a <code>View</code> is processing through <code>ViewInteraction</code> that has two main methods:
<code>onCheck</code> and <code>onPerform</code> which take <code>ViewAction</code> and <code>ViewAssertion</code> as arguments. Kakao was written based on this architecture.</p>
<p>So, we have set a goal to write Kautomator which would be like Kakao as much as possible. That's why we have introduced an additional layer over UiObject2 and UiDevice and that is so similar to <code>ViewInteraction</code>. This layer is represented by <code>UiObjectInteraction</code> and <code>UiDeviceInteraction</code> that have two methods: <code>onCheck</code> and <code>onPerform</code> taking UiObjectAssertion and UiObjectAction or UiDeviceAssertion and UiDeviceAction as arguments.</p>
<p><code>UiObjectInteraction</code> is designed to work with concrete <code>View</code> like <code>ViewInteraction</code>. <code>UiDeviceInteraction</code> has been created because UI Automator has a featureallowing you to do some system things like a click on Home button or on hard Back button, open Quick Setttings, open Notifications and so on. All such things are hidden by <code>UiSystem</code> class. </p>
<p>So, enjoy it =)</p>
<h4 id="advanced">Advanced</h4>
<h5 id="custom-uiview">Custom UiView</h5>
<p>If you have custom Views in your tests and you want to create your own <code>UiView</code>, we have <code>UiBaseView</code>. Just extend
this class and implement as much additional Action/Assertion interfaces as you want.
You also need to override constructors that you need.</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nc">UiMyView</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">UiBaseView</span><span class="o">&lt;</span><span class="n">KView</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">UiMyActions</span><span class="p">,</span><span class="w"> </span><span class="n">UiMyAssertions</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">constructor</span><span class="p">(</span><span class="n">selector</span><span class="p">:</span><span class="w"> </span><span class="n">UiViewSelector</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">super</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">constructor</span><span class="p">(</span><span class="n">builder</span><span class="p">:</span><span class="w"> </span><span class="n">UiViewBuilder</span><span class="p">.()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">super</span><span class="p">(</span><span class="n">builder</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<h5 id="intercepting">Intercepting</h5>
<p>If you need to add custom logic during the <code>Kautomator -&gt; UI Automator</code> call chain (for example, logging) or
if you need to completely change the <code>UiAssertion</code> or <code>UiAction</code> that are being sent to UI Automator
during runtime in some cases, you can use the intercepting mechanism.</p>
<p>Interceptors are lambdas that you pass to a configuration DSL that will be invoked before real calls
inside <code>UiObject2</code> and <code>UiDevice</code> classes in UI Automator.</p>
<p>You have the ability to provide interceptors at 3 different levels: Kautomator runtime, your 'UiScreen' classes
and any individual <code>UiView</code> instance.</p>
<p>On each invocation of UI Automator function that can be intercepted, Kautomator will aggregate all available interceptors
for this particular call and invoke them in descending order: <code>UiView interceptor -&gt; Active Screens interceptors -&gt;
Kautomator interceptor</code>.</p>
<p>Each of the interceptors in the chain can break the chain call by setting <code>isOverride</code> to true during configuration.
In that case Kautomator will not only stop invoking remaining interceptors in the chain, <strong>but will not perform the UI Automator
call</strong>. It means that in such case, the responsibility to actually invoke Kautomator lies on the shoulders
of the developer.</p>
<p>Here's the examples of intercepting configurations:
<div class="highlight"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nc">SomeTest</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nd">@Before</span><span class="w"></span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">KautomatorConfigurator</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Kautomator runtime</span><span class="w"></span>
<span class="w">            </span><span class="n">intercept</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">onUiInteraction</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Intercepting calls on UiInteraction classes across whole runtime</span><span class="w"></span>
<span class="w">                    </span><span class="n">onPerform</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">uiInteraction</span><span class="p">,</span><span class="w"> </span><span class="n">uiAction</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="c1">// Intercept perform() call</span><span class="w"></span>
<span class="w">                        </span><span class="n">testLogger</span><span class="p">.</span><span class="na">i</span><span class="p">(</span><span class="s">&quot;KautomatorIntercept&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;interaction=</span><span class="si">$</span><span class="n">uiInteraction</span><span class="s">, action=</span><span class="si">$</span><span class="n">uiAction</span><span class="s">&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                    </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">MyScreen</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">intercept</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">onUiInteraction</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Intercepting calls on UiInteraction classes while in the context of MyScreen</span><span class="w"></span>
<span class="w">                    </span><span class="n">onCheck</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">uiInteraction</span><span class="p">,</span><span class="w"> </span><span class="n">uiAssert</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="c1">// Intercept check() call</span><span class="w"></span>
<span class="w">                        </span><span class="n">testLogger</span><span class="p">.</span><span class="na">i</span><span class="p">(</span><span class="s">&quot;KautomatorIntercept&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;interaction=</span><span class="si">$</span><span class="n">uiInteraction</span><span class="s">, assert=</span><span class="si">$</span><span class="n">uiAssert</span><span class="s">&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                    </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>

<span class="w">            </span><span class="n">myView</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">intercept</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Intercepting ViewInteraction calls on this individual view</span><span class="w"></span>
<span class="w">                    </span><span class="n">onPerform</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">uiInteraction</span><span class="p">,</span><span class="w"> </span><span class="n">uiAction</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="c1">// Intercept perform() call and overriding the chain</span><span class="w"></span>
<span class="w">                        </span><span class="c1">// When performing actions on this view, Kautomator level interceptor will not be called</span><span class="w"></span>
<span class="w">                        </span><span class="c1">// and we have to manually call UI Automator now.</span><span class="w"></span>
<span class="w">                        </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="s">&quot;KAUTOMATOR_VIEW&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="si">$</span><span class="n">uiInteraction</span><span class="s"> is performing </span><span class="si">$</span><span class="n">uiAction</span><span class="s">&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">uiInteraction</span><span class="p">.</span><span class="na">perform</span><span class="p">(</span><span class="n">uiAction</span><span class="p">)</span><span class="w"></span>
<span class="w">                    </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
For more detailed info please refer to the documentation.</p>
<h3 id="accelerate-ui-automator">Accelerate UI Automator</h3>
<p>As you remember we told about the possible acceleration of UI Automator. How does it become a reality? <br>
UI Automator has an inner mechanism to prevent potential flakiness. Under the hood, the library listens and gives commands through AccessibilityManagerService. AccessibilityManagerService is a single point for all accessibility events in the system. At one moment, creators of UI Automator faced with the flakiness problem. One of the most popular reasons for such undetermined behavior is a big count of events processing in the System at the current moment. But UI Automator has a connection with AccessibilityManagerService. Such a connection gives an opportunity to listen to all accessibility events in the System and to wait for a calm state when there are no actions. The calm state leads to determined system behavior and decreases the possibility of flakiness. <br>
All of this pushed UI Automator authors to introduce the following algorithm: UI Automator waits 500ms (<code>waitForIdleTimeout</code> and <code>waitForSelectorTimeout</code> in <code>androidx.test.uiautomator.Configurator</code>) window during 10 seconds for <strong>each action</strong>. EACH ACTION. </p>
<p>Perhaps, described solution made UI Automator more stable. But, the speed crashed, no doubts.</p>
<p>Kautomator is a DSL over UI Automator that provides a <a href="../wiki/03_Kaspresso_configurator.md#kaspresso-interceptors-based-on-kakaokautomator-interceptors">mechanism of interceptors</a>. Kaspresso offers a big set of default interceptors which eliminates any potential flaky action. So, Kaspresso + Kautomator helps UI Automator to struggle with flakiness.</p>
<p>After some time, we thought why we need to save artificial timeouts inside UI Automator while Kaspresso + Kautomator does the same work. Have a look at the measure example:
<div class="highlight"><pre><span></span><code><span class="nd">@RunWith</span><span class="p">(</span><span class="n">AndroidJUnit4</span><span class="o">::</span><span class="n">class</span><span class="p">)</span><span class="w"></span>
<span class="kd">class</span><span class="w"> </span><span class="nc">KautomatorMeasureTest</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">TestCase</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">kaspressoBuilder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kaspresso</span><span class="p">.</span><span class="na">Builder</span><span class="p">.</span><span class="na">simple</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">kautomatorWaitForIdleSettings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KautomatorWaitForIdleSettings</span><span class="p">.</span><span class="na">boost</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">RANGE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.</span><span class="p">.</span><span class="m">20</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">Rule</span><span class="w"></span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">runtimePermissionRule</span><span class="p">:</span><span class="w"> </span><span class="n">GrantPermissionRule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GrantPermissionRule</span><span class="p">.</span><span class="na">grant</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="n">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">WRITE_EXTERNAL_STORAGE</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">READ_EXTERNAL_STORAGE</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="nd">@get</span><span class="p">:</span><span class="n">Rule</span><span class="w"></span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">activityTestRule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActivityTestRule</span><span class="p">(</span><span class="n">MainActivity</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">test</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">        </span><span class="n">before</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">activityTestRule</span><span class="p">.</span><span class="na">launchActivity</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">}.</span><span class="na">after</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}.</span><span class="na">run</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="o">======&gt;</span><span class="w"> </span><span class="n">UI</span><span class="w"> </span><span class="n">Automator</span><span class="p">:</span><span class="w">        </span><span class="m">0</span><span class="w"> </span><span class="n">minutes</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="m">252</span><span class="w"> </span><span class="n">millis</span><span class="w"></span>
<span class="w">    </span><span class="o">======&gt;</span><span class="w"> </span><span class="n">UI</span><span class="w"> </span><span class="n">Automator</span><span class="w"> </span><span class="n">boost</span><span class="p">:</span><span class="w">  </span><span class="m">0</span><span class="w"> </span><span class="n">minutes</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="m">310</span><span class="w"> </span><span class="n">millis</span><span class="w"></span>
<span class="w">            </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;MainScreen. Click on `measure fragment` button&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">UiMainScreen</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">measureButton</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                        </span><span class="n">isDisplayed</span><span class="p">()</span><span class="w"></span>
<span class="w">                        </span><span class="n">click</span><span class="p">()</span><span class="w"></span>
<span class="w">                    </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="o">======&gt;</span><span class="w"> </span><span class="n">UI</span><span class="w"> </span><span class="n">Automator</span><span class="p">:</span><span class="w">        </span><span class="m">0</span><span class="w"> </span><span class="n">minutes</span><span class="p">,</span><span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="m">725</span><span class="w"> </span><span class="n">millis</span><span class="w"></span>
<span class="w">    </span><span class="o">======&gt;</span><span class="w"> </span><span class="n">UI</span><span class="w"> </span><span class="n">Automator</span><span class="w"> </span><span class="n">boost</span><span class="p">:</span><span class="w">  </span><span class="m">0</span><span class="w"> </span><span class="n">minutes</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="n">millis</span><span class="w"></span>
<span class="w">            </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Measure screen. Button_1 clicks comparing&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">UiMeasureScreen</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">RANGE</span><span class="p">.</span><span class="na">forEach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"></span>
<span class="w">                        </span><span class="n">button1</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                            </span><span class="n">click</span><span class="p">()</span><span class="w"></span>
<span class="w">                            </span><span class="n">hasText</span><span class="p">(</span><span class="n">device</span><span class="p">.</span><span class="na">targetContext</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">measure_fragment_text_button_1</span><span class="p">).</span><span class="na">toUpperCase</span><span class="p">())</span><span class="w"></span>
<span class="w">                        </span><span class="p">}</span><span class="w"></span>
<span class="w">                    </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="o">======&gt;</span><span class="w"> </span><span class="n">UI</span><span class="w"> </span><span class="n">Automator</span><span class="p">:</span><span class="w">        </span><span class="m">0</span><span class="w"> </span><span class="n">minutes</span><span class="p">,</span><span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="m">789</span><span class="w"> </span><span class="n">millis</span><span class="w"></span>
<span class="w">    </span><span class="o">======&gt;</span><span class="w"> </span><span class="n">UI</span><span class="w"> </span><span class="n">Automator</span><span class="w"> </span><span class="n">boost</span><span class="p">:</span><span class="w">  </span><span class="m">0</span><span class="w"> </span><span class="n">minutes</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="m">482</span><span class="w"> </span><span class="n">millis</span><span class="w"></span>
<span class="w">            </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Measure screen. Button_2 clicks and TextView changes comparing&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">UiMeasureScreen</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">RANGE</span><span class="p">.</span><span class="na">forEach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"></span>
<span class="w">                        </span><span class="n">button2</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                            </span><span class="n">click</span><span class="p">()</span><span class="w"></span>
<span class="w">                            </span><span class="n">hasText</span><span class="p">(</span><span class="n">device</span><span class="p">.</span><span class="na">targetContext</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">measure_fragment_text_button_2</span><span class="p">).</span><span class="na">toUpperCase</span><span class="p">())</span><span class="w"></span>
<span class="w">                        </span><span class="p">}</span><span class="w"></span>
<span class="w">                        </span><span class="n">textView</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                            </span><span class="n">hasText</span><span class="p">(</span><span class="w"></span>
<span class="w">                                </span><span class="s">&quot;</span><span class="si">${</span><span class="n">device</span><span class="p">.</span><span class="na">targetContext</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">measure_fragment_text_textview</span><span class="p">)</span><span class="si">}${</span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="si">}</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">                            </span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="p">}</span><span class="w"></span>
<span class="w">                    </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="o">======&gt;</span><span class="w"> </span><span class="n">UI</span><span class="w"> </span><span class="n">Automator</span><span class="p">:</span><span class="w">        </span><span class="m">0</span><span class="w"> </span><span class="n">minutes</span><span class="p">,</span><span class="w"> </span><span class="m">45</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="m">903</span><span class="w"> </span><span class="n">millis</span><span class="w"></span>
<span class="w">    </span><span class="o">======&gt;</span><span class="w"> </span><span class="n">UI</span><span class="w"> </span><span class="n">Automator</span><span class="w"> </span><span class="n">boost</span><span class="p">:</span><span class="w">  </span><span class="m">0</span><span class="w"> </span><span class="n">minutes</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="m">967</span><span class="w"> </span><span class="n">millis</span><span class="w"></span>
<span class="w">            </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Measure fragment. EditText updates comparing&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">UiMeasureScreen</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">edit</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                        </span><span class="n">isDisplayed</span><span class="p">()</span><span class="w"></span>
<span class="w">                        </span><span class="n">hasText</span><span class="p">(</span><span class="n">device</span><span class="p">.</span><span class="na">targetContext</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">measure_fragment_text_edittext</span><span class="p">))</span><span class="w"></span>
<span class="w">                        </span><span class="n">RANGE</span><span class="p">.</span><span class="na">forEach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"></span>
<span class="w">                            </span><span class="n">clearText</span><span class="p">()</span><span class="w"></span>
<span class="w">                            </span><span class="n">typeText</span><span class="p">(</span><span class="s">&quot;bla-bla-bla&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                            </span><span class="n">hasText</span><span class="p">(</span><span class="s">&quot;bla-bla-bla&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                            </span><span class="n">clearText</span><span class="p">()</span><span class="w"></span>
<span class="w">                            </span><span class="n">typeText</span><span class="p">(</span><span class="s">&quot;mo-mo-mo&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                            </span><span class="n">hasText</span><span class="p">(</span><span class="s">&quot;mo-mo-mo&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                            </span><span class="n">clearText</span><span class="p">()</span><span class="w"></span>
<span class="w">                        </span><span class="p">}</span><span class="w"></span>
<span class="w">                    </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="o">======&gt;</span><span class="w"> </span><span class="n">UI</span><span class="w"> </span><span class="n">Automator</span><span class="p">:</span><span class="w">        </span><span class="m">0</span><span class="w"> </span><span class="n">minutes</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="m">901</span><span class="w"> </span><span class="n">millis</span><span class="w"></span>
<span class="w">    </span><span class="o">======&gt;</span><span class="w"> </span><span class="n">UI</span><span class="w"> </span><span class="n">Automator</span><span class="w"> </span><span class="n">boost</span><span class="p">:</span><span class="w">  </span><span class="m">0</span><span class="w"> </span><span class="n">minutes</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="n">millis</span><span class="w"></span>
<span class="w">            </span><span class="n">step</span><span class="p">(</span><span class="s">&quot;Measure fragment. Checkbox clicks comparing&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">UiMeasureScreen</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="n">RANGE</span><span class="p">.</span><span class="na">forEach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"></span>
<span class="w">                        </span><span class="n">checkBox</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                                </span><span class="n">setChecked</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"></span>
<span class="w">                                </span><span class="n">isChecked</span><span class="p">()</span><span class="w"></span>
<span class="w">                            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                                </span><span class="n">setChecked</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="w"></span>
<span class="w">                                </span><span class="n">isNotChecked</span><span class="p">()</span><span class="w"></span>
<span class="w">                            </span><span class="p">}</span><span class="w"></span>
<span class="w">                        </span><span class="p">}</span><span class="w"></span>
<span class="w">                    </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
It's a great deal! </p>
<p>Also, there are cases when UI Automator can't catch 500ms window. For example, when one element is updating too fast (one update in 100 ms). Just have a look at <a href="../samples/kaspresso-sample/src/androidTest/kotlin/com/kaspersky/kaspressample/idlingwait_tests/WaitForIdleTest.kt">this test</a>. Only <code>KautomatorWaitForIdleSettings.boost()</code> allows to pass the test.</p>
<p>As you see, we have introduced a special <code>kautomatorWaitForIdleSettings</code> property in Kaspresso configurator. By default, this property is <strong>not</strong> boost. Why? Because:
1. You can have tests where you use UI Automator directly. But mentioned timeouts are global parameters. Resetting of these timeouts can lead to an undetermined state.
2. We want to take time collecting data from the world and then to analyze potential problems of our solutions (but, we believe it's a stable and brilliant solution).</p>
<p>Another important remark is about <code>kaspressoBuilder = Kaspresso.Builder.simple</code> configuration. This configuration is faster than <code>advanced</code> because of each step's screenshots interceptor absence. If you need, add them manually.</p>
<p>Anyway, it's a small change for a developer, but it's a big step for the world =)</p>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../01_Wrapper_over_Espresso/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Wrapper over Espresso" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Wrapper over Espresso
            </div>
          </div>
        </a>
      
      
        
        <a href="../03_Kaspresso_configurator/" class="md-footer__link md-footer__link--next" aria-label="Next: Kaspresso configurator" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Kaspresso configurator
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "content.code.annotate", "navigation.tabs.sticky", "navigation.instant", "navigation.tracking", "navigation.top", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.37e9125f.min.js"></script>
      
    
  </body>
</html>